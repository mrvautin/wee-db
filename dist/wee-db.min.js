(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory(require("_"));else if(typeof define==="function"&&define.amd)define(["_"],factory);else if(typeof exports==="object")exports["wee_db"]=factory(require("_"));else root["wee_db"]=factory(root["_"])})(this,function(__WEBPACK_EXTERNAL_MODULE_6__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module,exports,__webpack_require__){var low=__webpack_require__(1);var index=__webpack_require__(5);module.exports=function weeDB(source){return index(low(source))}},function(module,exports,__webpack_require__){"use strict";var index=__webpack_require__(2);var storage=__webpack_require__(4);module.exports=function low(source){var opts=arguments.length<=1||arguments[1]===undefined?{storage:storage}:arguments[1];return index(source,opts,window._)}},function(module,exports,__webpack_require__){"use strict";var isPromise=__webpack_require__(3);module.exports=function(source){var _ref=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var _ref$format=_ref.format;var format=_ref$format===undefined?null:_ref$format;var _ref$storage=_ref.storage;var storage=_ref$storage===undefined?null:_ref$storage;var _ref$writeOnChange=_ref.writeOnChange;var writeOnChange=_ref$writeOnChange===undefined?true:_ref$writeOnChange;var lodash=arguments[2];var _=lodash.runInContext();var db=_.chain({});if(source){if(format){if(format.serialize){db.serialize=format.serialize}if(format.deserialize){db.deserialize=format.deserialize}}if(storage){if(storage.read){db.read=function(){var s=arguments.length<=0||arguments[0]===undefined?source:arguments[0];var res=storage.read(s,db.deserialize);var init=function init(obj){db.__wrapped__=obj;db._checksum=JSON.stringify(db.__wrapped__)};if(isPromise(res)){return res.then(function(obj){init(obj);return db})}init(res);return db}}if(storage.write){db.write=function(){var dest=arguments.length<=0||arguments[0]===undefined?source:arguments[0];return storage.write(dest,db.__wrapped__,db.serialize)}}}}function persist(){if(db.source&&db.write&&writeOnChange){var str=JSON.stringify(db.__wrapped__);if(str!==db._checksum){db._checksum=str;db.write(db.source)}}}_.prototype.value=_.wrap(_.prototype.value,function(value){var v=value.apply(this);persist();return v});db.getState=function(){return db.__wrapped__};db.setState=function(state){db.__wrapped__=state;persist()};db._=_;db.source=source;if(db.read){return db.read()}else{return db}}},function(module,exports){module.exports=isPromise;function isPromise(obj){return!!obj&&(typeof obj==="object"||typeof obj==="function")&&typeof obj.then==="function"}},function(module,exports){"use strict";module.exports={read:function read(source){var deserialize=arguments.length<=1||arguments[1]===undefined?JSON.parse:arguments[1];var data=localStorage.getItem(source);if(data){return deserialize(data)}else{localStorage.setItem(source,"{}");return{}}},write:function write(dest,obj){var serialize=arguments.length<=2||arguments[2]===undefined?JSON.stringify:arguments[2];return localStorage.setItem(dest,serialize(obj))}}},function(module,exports,__webpack_require__){var _=__webpack_require__(6);var uuid=__webpack_require__(7);module.exports=function(source){var db=source;var wee_db={};wee_db.update=function(collection,query,value,cb){if(typeof collection!=="string"){throw new Error("Collection not supplied")}if(typeof query!=="object"){throw new Error("Query not supplied")}if(typeof value!=="object"){throw new Error("Value not supplied")}var callback=typeof cb==="function";checkCollection(collection,db);var check=db.get(collection).filter(query).value();if("id"in value){throw new Error("Cannot update ID field")}_.forEach(check,function(document){db.get(collection).filter(_.merge(document,value)).value()});var afterCheck=db.get(collection).filter(_.merge(query,value)).value();var returnObj={count:_.size(afterCheck),documents:afterCheck};if(callback===true){cb(null,returnObj)}else{return returnObj}return""};wee_db.upsert=function(collection,query,value,cb){if(typeof collection!=="string"){throw new Error("Collection not supplied")}if(typeof query!=="object"){throw new Error("Query not supplied")}if(typeof value!=="object"){throw new Error("Value not supplied")}var callback=typeof cb==="function";checkCollection(collection,db);var check=db.get(collection).filter(query).value();if("id"in value){throw new Error("Cannot update ID field")}if(_.size(check)===0){this.insert(collection,_.merge(query,value))}else{_.forEach(check,function(document){db.get(collection).filter(_.merge(document,value)).value()})}var afterCheck=db.get(collection).filter(_.merge(query,value)).value();var returnObj={count:_.size(afterCheck),documents:afterCheck};if(callback===true){cb(null,returnObj)}else{return returnObj}return""};wee_db.insert=function(collection,value,cb){if(typeof collection!=="string"){throw new Error("Collection not supplied")}if(typeof value!=="object"){throw new Error("Value not supplied")}var callback=typeof cb==="function";checkCollection(collection,db);if("id"in value){var check=db.get(collection).find({id:value.id}).value();var returnObj={};if(_.size(check)===0){db.get(collection).push(_.merge(value)).value();var afterCheck=db.get(collection).filter({id:value.id}).value();returnObj={count:1,documents:afterCheck};if(callback===true){cb(null,returnObj)}else{return returnObj}}else{returnObj={count:0,documents:[]};if(callback===true){cb('Duplicate "id" key found',null)}else{return returnObj}}}else{var uid=uuid();db.get(collection).push(_.merge({id:uid},value)).value();var GenIDafterCheck=db.get(collection).filter({id:uid}).value();returnObj={count:_.size(GenIDafterCheck),documents:GenIDafterCheck};if(callback===true){cb(null,returnObj)}else{return returnObj}}return""};wee_db.findOne=function(collection,query,cb){if(typeof collection!=="string"){throw new Error("Collection not supplied")}if(typeof query!=="object"){throw new Error("Query not supplied")}var callback=typeof cb==="function";var find=db.get(collection).find(query).value();var dataReturn=find;if(!dataReturn){dataReturn={}}var returnObj={count:find?1:0,documents:dataReturn};if(callback===true){cb(null,returnObj)}else{return returnObj}return""};wee_db.find=function(collection,query,cb){if(typeof collection!=="string"){throw new Error("Collection not supplied")}if(typeof query!=="object"){throw new Error("Query not supplied")}var callback=typeof cb==="function";var find=db.get(collection).filter(query).value();var returnObj={count:_.size(find),documents:find};if(callback===true){cb(null,returnObj)}else{return returnObj}return""};wee_db._find=function(collection){if(typeof collection!=="string"){throw new Error("Collection not supplied")}return db.get(collection)};wee_db.remove=function(collection,query,cb){if(typeof collection!=="string"){throw new Error("Collection not supplied")}if(typeof query!=="object"){throw new Error("Query not supplied")}var callback=typeof cb==="function";var check=db.get(collection).filter(query).value();var returnObj={};if(_.size(check)>0){db.get(collection).remove(query).value();returnObj={count:_.size(check),documents:[]};if(callback===true){cb(null,returnObj)}else{return returnObj}}else{returnObj={count:0,documents:[]};if(callback===true){cb(null,returnObj)}else{return returnObj}}return""};return wee_db};function checkCollection(collection,db){var coll=db.get(collection).value();if(typeof coll==="undefined"){var collObj={};collObj[collection]=[];db.defaults(collObj).value()}}},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_6__},function(module,exports,__webpack_require__){var _rng=__webpack_require__(8);var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16){buf[i+ii++]=_hexToByte[oct]}});while(ii<16){buf[i+ii++]=0}return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!==undefined?options.clockseq:_clockseq;var msecs=options.msecs!==undefined?options.msecs:(new Date).getTime();var nsecs=options.nsecs!==undefined?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===undefined){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs===undefined){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;n++){b[i+n]=node[n]}return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new Array(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;ii++){buf[i+ii]=rnds[ii]}}return buf||unparse(rnds)}var uuid=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;uuid.unparse=unparse;module.exports=uuid},function(module,exports){(function(global){var rng;var crypto=global.crypto||global.msCrypto;if(crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}module.exports=rng}).call(exports,function(){return this}())}])});